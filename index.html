<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8>

    <title>Identifying the best drug dealers and cool people to be friend with</title>

    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <!-- CSS Source -->
 <link rel="stylesheet" href="./styles/main.css" />
    <link href='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css' rel='stylesheet' />
	

    <!-- JS Libraries -->
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.6/d3.min.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js'></script>

    <!-- JS Source -->
	<script src="./scripts/timeline.js"></script>
	<script src="./scripts/networkgraph.js"></script>
	<script src='scripts/mapapp.js'></script>
	<!-- <script src='scripts/mapdocapp.js'></script> -->

</head>

<body>

    <div class="container-fluid">
		<div class="row">
			<div class='col-md-6'>
				<h3>Patient Locations</h3>
			</div>
			<div class='col-md-6'>
				<h3>Pharmacy Locations (Placeholder)</h3>
			</div>
		</div>
		<div class="row" id="maps">
            <div class="col-md-6" id="patient">
                <svg width=100% id="patsvg" height="400px"></svg>
               
            </div>
			<div class="col-md-6" id="paths">
                <svg width=100% id="pathsvg" height="400px"></svg>
            </div>
        </div>
        <div class="row" id="maps2" style="display:none">
            <div class="col-md-6" id="patient2">
                <svg width=100% id="patsvg" height="400px"></svg>
               
            </div>
			<div class="col-md-6" id="paths2">
                <svg width=100% id="pathsvg" height="400px">
                 </svg>
            </div>
        </div>
		<div class="row">
			<div class='col-md-6'>
				<h4>Patient-Doctor/Pharmacy Connections</h4>
			</div>
			<div class='col-md-6'>
				<h4 id='timeline-title'>Patient prescriptions vs Time</h4>
			</div>
		</div>
        <div class="row" id="gantt-items">
			<div class="col-md-6" id="network">
			 </div>
			<div class="col-md-6" id="gantt-chart">
			</div>
			<div class="col-md-6" id="gantt-filters" height='200px'>
			</div>
       </div>
	   
	<div id="radio">
        <input type="radio" name="people" id="patientRadioSwitch" value="1" checked>By Patients<br>
		<input type="radio" name="people" id="doctorRadioSwitch" value="0" >By Doctors<br>
	</div>

    </div>
    <script>
    var count = 1;
<<<<<<< Updated upstream
    function show2(){
 
    	indi_pat = false;
  		document.getElementById('maps').style.display ='none';
  		document.getElementById('maps2').style.display ='block';
  		// if(count==1){
  		// 	change_indiLoc();
  		// }
  		selected_id = 196479993;
  		change_indiLoc();

	}

	function show1(){
		indi_pat = true;
  		document.getElementById('maps2').style.display ='none';
  		document.getElementById('maps').style.display ='block';
  		selected_id = 2098621;
  		change_indiLoc();
=======
   
	selected_id = 2098621;//260650195;
>>>>>>> Stashed changes

	var is_patient = true;
	
	
	

	d3.queue()
    .defer(d3.csv,"https://gist.githubusercontent.com/tehwentzel/24bf8357ad86a3db70510480b020d7d3/raw/4468783d3445b83b4350ac1c1327a0b592c8cfdf/455_pharmacies.csv")
    .defer(d3.csv,"https://gist.githubusercontent.com/tehwentzel/24bf8357ad86a3db70510480b020d7d3/raw/4468783d3445b83b4350ac1c1327a0b592c8cfdf/500_doctors.csv")
    .defer(d3.csv,"https://gist.githubusercontent.com/tehwentzel/24bf8357ad86a3db70510480b020d7d3/raw/4468783d3445b83b4350ac1c1327a0b592c8cfdf/5000_patients.csv")
    .defer(d3.csv,"https://gist.githubusercontent.com/tehwentzel/24bf8357ad86a3db70510480b020d7d3/raw/4468783d3445b83b4350ac1c1327a0b592c8cfdf/27073_prescriptions.csv")
	.defer(d3.csv,"https://raw.githubusercontent.com/tehwentzel/VDS_Opioid_Abuse_Visualization/master/data/node_graph1.csv?token=Ah_SvLgamzIb9eWrAaZ3MG3u4zWm7fVoks5b_vcLwA%3D%3D")
    .await(start_here);
	
    function start_here(error, PHARMACY_LOC, DOCTOR_LOC, PATIENT_LOC,PRESCRIPTION_LOC,NODE_GRAPH) {
        if (error) return console.log(error);
		console.log("running");
		var patientMap = getMap('patient');
		var pathMap = getMap('paths');
		
		var show2 = function() {
			is_patient = true;
			//document.getElementById('maps').style.display ='none';
			//document.getElementById('maps2').style.display ='block';
			// if(count==1){
			// 	change_indiLoc();
			// }
			//selected_id = 260650195;
			var [addresses, paths] = change_indiLoc();
		}
		var show1 = function(){
			is_patient = false;
			//document.getElementById('maps2').style.display ='none';
			//document.getElementById('maps').style.display ='block';
			//selected_id = 260650195;
			var [addresses, paths] = change_indiLoc();

		}	
		var change_indiLoc = function(PHARMACY_LOC, DOCTOR_LOC, PATIENT_LOC,PRESCRIPTION_LOC){
			var addresses;
			var paths;
			if(is_patient == true){
				addresses = patientMap(PATIENT_LOC, PRESCRIPTION_LOC, 'patient', is_patient, count);
				paths = pathMap(PHARMACY_LOC, PRESCRIPTION_LOC, 'paths', is_patient, count);
				// console.log("count1", count)
			}
			else{
				addresses = patientMap(DOCTOR_LOC, PRESCRIPTION_LOC, 'patient', is_patient, count);
				paths = pathMap(PHARMACY_LOC, PRESCRIPTION_LOC,'paths', is_patient, count);
				// console.log("count2", count)
			}
			return [addresses, paths];
		}
		var setDotOnClick = g => g.on('click', function(d){
		if(is_patient){
			timeline.setID(d.pat_id, "Patient", null);
			struct=createStruct(d.pat_id,NODE_GRAPH);
			tryS(struct);
			}
		else{
			timeline.setID(d.physiciannpi, "Doctor", null);
			//struct=createStruct(d.physiciannpi,NODE_GRAPH);
			//tryS(struct);
			}
		});
		
		var [addresses, paths] = change_indiLoc(PHARMACY_LOC, DOCTOR_LOC, PATIENT_LOC,PRESCRIPTION_LOC);
       
		timeline = new TimeLine(selected_id, PRESCRIPTION_LOC, is_patient? "Patient":"Doctor");
		struct = createStruct(selected_id,NODE_GRAPH);
        tryS(struct);
		addresses.call(setDotOnClick);
		var patientSelection = d3.select("#radio").selectAll("input").on('click',function(d){
			var was_patient = (is_patient)? true:false;
			is_patient = document.getElementById("patientRadioSwitch").checked;
			console.log(is_patient);
			if(is_patient != was_patient){
				d3.selectAll("circle.dot").remove();
				[addresses, paths] = change_indiLoc(PHARMACY_LOC, DOCTOR_LOC, PATIENT_LOC,PRESCRIPTION_LOC);
				addresses.call(setDotOnClick);
			}
		});
    }

    </script>

    <!-- <script src='scripts/mapapp.js'></script> -->

    

</body>
</html>